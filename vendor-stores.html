<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>e-Kiraana ‚Ä¢ Vendor Stores</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="navbar">
  <div class="container inner">
    <div class="brand"><div class="logo">E</div> e-Kiraana</div>
    <div class="nav-actions">
      <a class="btn outline" href="vendor.html">Dashboard</a>
      <a class="btn outline" href="vendor-products.html">Products</a>
      <a class="btn outline" href="vendor-orders.html">Orders</a>
    </div>
  </div>
</div>

<div class="container">
  <div class="hero">
    <h1>My Stores üè™</h1>
    <p>Create store and manage store details.</p>
  </div>

  <div class="grid cols-2">
    <!-- Create Store -->
    <div class="card">
      <div class="title">Create New Store</div>

      <input class="input" id="storeName" placeholder="Store name (eg: Darshan Kirana)">
      <br><br>

      <input class="input" id="location" placeholder="Location (eg: Hubli, Vidyanagar)">
      <br><br>

      <input class="input" id="imageUrl" placeholder="Store image URL (optional)">
      <br><br>

      <button class="btn" onclick="createStore()">Create Store</button>
      <p class="small" id="msg" style="margin-top:10px"></p>
    </div>

    <!-- Store List -->
    <div class="card">
      <div class="title">Your Stores</div>
      <div class="small">Only your stores are shown.</div>
      <hr>
      <div id="storeList"></div>
    </div>
  </div>
</div>

<div class="toast" id="toast">Done ‚úÖ</div>

<script>
const API="https://script.google.com/macros/s/AKfycbwnE6rvhunQy8pbs5y_N7kjjSW5hf58ypxg24nmSO5LzMmxEOajlXc1uY6IMjGO0Uo/exec";

function api(params){
  const url = API + "?" + new URLSearchParams(params).toString();
  return fetch(url).then(r=>r.json());
}

function toast(text,type="green"){
  const t=document.getElementById("toast");
  t.textContent=text;
  t.style.background=(type==="red")?"#ef4444":(type==="yellow")?"#f59e0b":"#16a34a";
  t.style.display="block";
  setTimeout(()=>t.style.display="none",1800);
}

const vendor=localStorage.getItem("user");
const role=localStorage.getItem("role");
if(!vendor) location.href="index.html";
if(role!=="vendor") location.href="index.html";

function createStore(){
  const storeName=document.getElementById("storeName").value.trim();
  const location=document.getElementById("location").value.trim();
  const imageUrl=document.getElementById("imageUrl").value.trim();
  const msg=document.getElementById("msg");
  msg.textContent="";

  if(!storeName){
    msg.textContent="Store name required!";
    toast("Fill store name ‚ö†Ô∏è","yellow");
    return;
  }

  api({
    action:"vendorCreateStore",
    vendor,
    storeName,
    location,
    rating:"4.5",
    imageUrl
  }).then(d=>{
    if(d.ok){
      toast("Store created ‚úÖ");
      document.getElementById("storeName").value="";
      document.getElementById("location").value="";
      document.getElementById("imageUrl").value="";
      loadStores();
    } else {
      msg.textContent=d.msg || "Failed";
      toast("Failed ‚ùå","red");
    }
  }).catch(err=>{
    console.error(err);
    toast("Server error ‚ùå","red");
  });
}

function storeCard(s){
  const safeImg = s.imageUrl || "https://images.unsplash.com/photo-1542838132-92c53300491e?w=800&q=60";
  return `
    <div class="card" style="margin-bottom:12px">
      <img class="card-img" src="${safeImg}" onerror="this.src='https://images.unsplash.com/photo-1542838132-92c53300491e?w=800&q=60'"/>
      <div class="title" style="margin-top:10px">${s.storeName}</div>
      <div class="small">üìç ${s.location || "-"}</div>
      <div class="small">‚≠ê ${s.rating || "4.5"}</div>
      <div class="small"><b>Store ID:</b> ${s.storeId}</div>
    </div>
  `;
}

function loadStores(){
  api({action:"vendorStores", vendor})
  .then(rows=>{
    const box=document.getElementById("storeList");
    box.innerHTML="";

    for(let i=1;i<rows.length;i++){
      const r=rows[i];
      box.innerHTML += storeCard({
        storeId:r[0], storeName:r[1], location:r[2], rating:r[3], imageUrl:r[4]
      });
    }

    if(rows.length<=1){
      box.innerHTML=`<div class="small">No stores created yet.</div>`;
    }
  })
  .catch(err=>{
    console.error(err);
    toast("Failed to load stores ‚ùå","red");
  });
}

loadStores();
</script>

<div class="footer-space"></div>
</body>
</html>
