<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>e-Kiraana â€¢ Admin Panel</title>
  <link rel="stylesheet" href="style.css">
  <style>
    .stat{display:flex;flex-direction:column;gap:6px}
    .statNum{font-size:28px;font-weight:1000}
    .statLbl{opacity:.75;font-weight:900}
  </style>
</head>
<body>

<div class="navbar">
  <div class="container inner">
    <div class="brand"><div class="logo">E</div> e-Kiraana</div>
    <div class="nav-actions">
      <a class="btn outline" href="admin-users.html">Users</a>
      <a class="btn outline" href="admin-stores.html">Stores</a>
      <a class="btn outline" href="admin-orders.html">Orders</a>
      <a class="btn outline" href="admin-categories.html">Categories</a>
      <button class="btn danger" onclick="logout()">Logout</button>
    </div>
  </div>
</div>

<div class="container">
  <div class="hero">
    <h1>Admin Dashboard ğŸ‘‘</h1>
    <p>Analytics + manage full platform.</p>
  </div>

  <!-- âœ… Analytics -->
  <div class="grid cols-4">
    <div class="card stat">
      <div class="statLbl">Total Users</div>
      <div class="statNum" id="sUsers">â€”</div>
      <div class="small">All registrations</div>
    </div>

    <div class="card stat">
      <div class="statLbl">Total Vendors</div>
      <div class="statNum" id="sVendors">â€”</div>
      <div class="small">Shop owners</div>
    </div>

    <div class="card stat">
      <div class="statLbl">Total Revenue</div>
      <div class="statNum" id="sRevenue">â‚¹â€”</div>
      <div class="small">All orders sum</div>
    </div>

    <div class="card stat">
      <div class="statLbl">Today Orders</div>
      <div class="statNum" id="sToday">â€”</div>
      <div class="small">Orders created today</div>
    </div>
  </div>

  <div class="grid cols-4" style="margin-top:16px">
    <div class="card">
      <div class="title">Users</div>
      <div class="small">Customers, vendors, delivery partners</div><br>
      <a class="btn" href="admin-users.html">Open</a>
    </div>
    <div class="card">
      <div class="title">Stores</div>
      <div class="small">All vendor stores listing</div><br>
      <a class="btn" href="admin-stores.html">Open</a>
    </div>
    <div class="card">
      <div class="title">Orders</div>
      <div class="small">Tracking, filters, search</div><br>
      <a class="btn" href="admin-orders.html">Open</a>
    </div>
    <div class="card">
      <div class="title">Categories</div>
      <div class="small">Add / Delete categories</div><br>
      <a class="btn" href="admin-categories.html">Open</a>
    </div>
  </div>
</div>

<div class="toast" id="toast">Loaded âœ…</div>

<script>
const API="https://script.google.com/macros/s/AKfycbwnE6rvhunQy8pbs5y_N7kjjSW5hf58ypxg24nmSO5LzMmxEOajlXc1uY6IMjGO0Uo/exec";
function api(params){
  const url = API + "?" + new URLSearchParams(params).toString();
  return fetch(url).then(r=>r.json());
}
function toast(text,type="green"){
  const t=document.getElementById("toast");
  t.textContent=text;
  t.style.background=(type==="red")?"#ef4444":(type==="yellow")?"#f59e0b":"#16a34a";
  t.style.display="block";
  setTimeout(()=>t.style.display="none",1500);
}

const user = localStorage.getItem("user");
const role = localStorage.getItem("role");
if(!user) location.href="index.html";
if(role!=="admin") location.href="index.html";

function logout(){ localStorage.clear(); location.href="index.html"; }

function loadAnalytics(){
  api({action:"adminAnalytics"})
  .then(d=>{
    if(!d.ok){ toast("Analytics error âŒ","red"); return; }
    document.getElementById("sUsers").textContent = d.totalUsers;
    document.getElementById("sVendors").textContent = d.totalVendors;
    document.getElementById("sRevenue").textContent = "â‚¹" + Math.round(Number(d.totalRevenue||0));
    document.getElementById("sToday").textContent = d.todayOrders;
    toast("Analytics loaded âœ…");
  })
  .catch(err=>{
    console.error(err);
    toast("Server error âŒ","red");
  });
}

loadAnalytics();
</script>

<div class="footer-space"></div>
</body>
</html>
